# **3. 영속성 관리**

-   JPA가 제공하는 기능은 크게 두가지가 있음
    1. 엔티티와 테이블을 매핑하는 설계 부분
    2. 매핑한 엔티티를 실제로 사용하는 부분
-   엔티티 매니저는 엔티티를 저장 / 수정 / 삭제 / 조회 하는 등 엔티티와 관련된 일을 한다.
-   엔티티 매니저는 엔티티를 저장하는 가상의 데이터베이스로 생각하면 된다.

## **3.1 엔티티 매니저 팩토리와 엔티티 매니저**

-   데이터베이스를 하나만 사용하는 애플리케이션은 일반적으로 EntityManagerFactory 를 하나만 생성하고, 엔티티 매니저 팩토리에서 엔티티 매니저를 생성하여 사용한다.
-   엔티티 매니저 팩토리를 생성하는 비용은 상당히 크고 팩토리에서 엔티티 매니저를 생성하는 비용은 적다.
-   엔티티 매니저 팩토리는 여러 스레드가 동시에 접근해도 안전하므로 서로 다른 스레드간 공유 가능
-   엔티티 매니저는 동시성 문제가 발생하므로 스레드간 절대 공유 하면 안된다.
-   엔티티 매니저는 데이터베이스 연결이 꼭 필요한 시점까지 커넥션을 얻지 않고 보통 트랜잭션을 시작할 때 커넥션을 획득한다.
-   JPA 구현체들은 EntityMangerFactory 를 생성할때 커넥션풀도 만드는데, JEE 환경(스프링 프레임워크 포함)에서 사용하면 해당 컨테이너가 제공하는 데이터소스를 사용한다.

## **3.2 영속성 컨텍스트란?**

-   영속성 컨텍스트는 우리말로 해석하면 '엔티티를 영구 저장하는 환경' 이라는 뜻이다.
-   엔티티 매니저를 통해 엔티티를 사용하면 엔티티 매니저는 영속성 컨텍스트에 엔티티를 보관하고 관리한다.
-   persist 메소드는 단순히 엔티티를 저장한다고 표현하기 보다는, **'엔티티 매니저를 사용해서 회원 엔티티를 영속성 컨텍스트에 저장 한다'** 가 더 정확한 말이다.
-   영속성 컨텍스트는 논리적 개념에 가깝다.
-   영속성 컨텍스트는 엔티티 매니저를 생성할 때 하나 만들어진다. 그리고 그 엔티티 매니저는 영속성 컨택스트에 접근할 수 있고, 영속성 컨텍스트를 관리할 수 있다.
